# 实现接口

实现`UserDetailsService` 接口,重写 loadUserByUsername 方法

方法会根据用户名，得到密码和角色，如果用户的输入的密码一致，则认证通过

```java
@Service
public class UserServiceImpl  implements UserDetailsService {

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        if(!"zhangsan".equals(username)){
            return null;
        }
        List<SimpleGrantedAuthority> authorities = new ArrayList<>();
        authorities.add(new SimpleGrantedAuthority("ROLE_USER"));
        UserDetails user = new User(username,"{noop}123456",authorities);
        return user;
    }
}
```

更改 认证提供者,前提是包扫描到

```xml
<security:authentication-manager>
    <security:authentication-provider user-service-ref="userServiceImpl"/>
</security:authentication-manager>
```



# 接入数据库

之前是定义的用户名和密码及角色，现在接入 mybatis 从数据库中查询，表和实体对象 可以自行设计

```java
@Slf4j
@Service
@Transactional
public class UserServiceImpl implements UserDetailsService {

    @Autowired
    private UserMapper userMapper;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        SysUser sysUser = userMapper.selectUserByUsername(username);
        if (sysUser == null) {
            log.info("user not exist:" + username);
            return null;
        }
        List<SysRole> sysRoles = userMapper.selectRoleListByUserId(sysUser.getUserId());
        List<SimpleGrantedAuthority> authorities = new ArrayList<>();
        for (SysRole sysRole : sysRoles) {
            authorities.add(new SimpleGrantedAuthority(sysRole.getRoleName()));
        }
        String password = "{noop}" + sysUser.getPassword();
        return new User(username, password, authorities);
    }
}
```

