# 异步执行

spring 通过 `org.springframework.core.task.TaskExecutor`来执行异步任务，有多种实现，

常用`org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor`

配置 

```xml
<bean id="taskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"/>
```

自定义一个任务类，实现 Runnable 接口

```java
public class HelloTask implements Runnable {

    private Integer count;

    public HelloTask(Integer count) {
        this.count = count;
    }

    @Override
    public void run() {
        System.out.println("hello" + count + ":" + new Date());
    }
}
```

通过获取 TaskExecutor 的 bean 来异步执行任务。

```java
public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext("spring.xml");
    TaskExecutor taskExecutor = context.getBean("taskExecutor", TaskExecutor.class);
    for (int i = 0; i < 20; i++) {
        taskExecutor.execute(new HelloTask(i));
    }
}
```

# 任务调度

spring 通过 `org.springframework.scheduling.TaskScheduler` 接口去执行任务调度，有多种实现

通常使用 `org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler`

配置 ,  这个调度器需要调用初始化方法 `initialize()`。

```xml
<bean id="taskScheduler" class="org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler" init-method="initialize"/>
```

获取` TaskScheduler` 的bean，指定一个时间，该任务会在指定的时间执行一次。

```java
public static void main(String[] args) {
    ApplicationContext context=new ClassPathXmlApplicationContext("spring.xml");
    TaskScheduler taskScheduler = context.getBean("taskScheduler", TaskScheduler.class);

    Date date = new Date(120,8,30,17,31,0);
    taskScheduler.schedule(new HelloTask(1),date);
}
```

还有 设置固定的间隔持续执行。

```java
taskScheduler.scheduleWithFixedDelay(new HelloTask(1),5000L);
taskScheduler.scheduleAtFixedRate(new HelloTask(1),5000L);
```

还可以使用 Trigger ，更加灵活的定义任务，常用 `org.springframework.scheduling.support.CronTrigger`

使用cron表达式定义。

```java
taskScheduler.schedule(new HelloTask(1),new CronTrigger("0/5 * * * * ?"));
```

# 注解支持

