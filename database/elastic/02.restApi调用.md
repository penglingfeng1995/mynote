# 概念

索引：数据的存储单元，相当于表

文档：存储的数据，相当于一行记录

映射：文档写入索引前，会分析分词，过滤，一般由用户自定义规则。

文档类型：定义了文档的结构和数据类型

# 索引

## 创建

执行 PUT 请求，`/stu` ,即为添加了一个 stu 的索引

```http
PUT http://192.168.80.128:9200/stu
```

## 删除

执行 DELETE 请求 /stu，即为删除索引

```http
DELETE http://192.168.80.128:9200/stu
```

# 文档

## 添加

执行 POST 请求   `/索引/类型/id`  ,设置 Content-Type 为 application/json

```http
POST http://192.168.80.128:9200/stu/student/1001

{
	"sname":"张三",
	"sage":12
}
```

其中 id 可以不设置，会默认生成一个 id 作为唯一标识符

![](img/e1.png)

## 修改

执行 PUT请求，带上 id ，全量覆盖更新,字段变化也会覆盖

```http
PUT http://192.168.80.128:9200/stu/student/1001

{
	"sname":"李四",
	"site":"广州"
}
```

上面每次都有把之前的值先获取到，还可以局部修改

执行 POST ，url 最后带上 `/_update`  作为标识，数据包装在 doc 属性下

```http
POST http://192.168.80.128:9200/stu/student/1001/_update

{
	"doc":{
		"sage":18
	}
}
```

## 删除

执行 DELETE ,带上 id 即可删除

```http
DELETE http://192.168.80.128:9200/stu/student/1001
```

## 查询

执行 GET 请求

```http
GET http://192.168.80.128:9200/stu/student/1001
```

得到 响应的 json 数据

```json
{
    "_index": "stu",
    "_type": "student",
    "_id": "1001",
    "_version": 1,
    "_seq_no": 5,
    "_primary_term": 1,
    "found": true,
    "_source": {
        "sname": "亚索",
        "sage": 12
    }
}
```

全量查询,不指定 id ，通过 `/_search` 标识，但是一次最多返回 10条

```http
GET http://192.168.80.128:9200/stu/student/_search
```

按条件搜索,通过 参数 q=k:v ，设置要查询的参数和值

```http
GET http://192.168.80.128:9200/stu/student/_search?q=sage:12
```

## DSL 查询

通过 POST 请求，把查询条件作为参数，支持复杂的查询条件

```http
POST http://192.168.80.128:9200/stu/student/_search

{
  "query":{
  	"match":{
  		"sage":12
  	}
  }
}
```

### 高亮

查询条件中，设置 highlight 属性，设置高亮字段，高亮字段需要作为查询条件

```json
{
  "query":{
  	"match":{
  		"sname":"亚索"
  	}
  },
  "highlight":{
  	"fields":{
  		"sname":{}
  	}
  }
}
```

得到的单个元素为

```json
{
    "_index": "stu",
    "_type": "student",
    "_id": "1001",
    "_score": 1.3862944,
    "_source": {
        "sname": "亚索",
        "sage": 12
    },
    "highlight": {
        "sname": [
            "<em>亚</em><em>索</em>"
        ]
    }
}
```

### 聚合

聚合类似于 sql 的 group by ，参数中指定要聚合的字段

```json
{
 "aggs":{
 	"all_interesets":{
 		"terms":{
 			"field":"sage"
 		}
 	}
 }
}
```

得到的结果中,就会得到值为该值的有几个,如年龄为12的总共3个

```json
"aggregations": {
    "all_interesets": {
        "doc_count_error_upper_bound": 0,
        "sum_other_doc_count": 0,
        "buckets": [
            {
                "key": 12,
                "doc_count": 3
            },
            {
                "key": 13,
                "doc_count": 2
            }
        ]
    }
}
```

